import{_,c as b,w as n,r as i,v as c,o as C,b as t,e as g,B as V,p as w}from"./index-g7Qn_UOI.js";const S={data(){return{form:null,isSubmitting:!1,Alerts:!0,NotificationFrequencyItems:[{title:"Every 15 minutes",value:"15_min"},{title:"Every 30 minutes",value:"30_min"},{title:"Hourly",value:"hourly"},{title:"Daily",value:"daily"},{title:"Weekly",value:"weekly"},{title:"Monthly",value:"monthly"},{title:"Instantly",value:"instant"}],NotificationFrequency:"instant",ThresholdEnergyConsumption:100,ToggleThresholdEnergyConsumption:!0,ThresholdCosts:50,ToggleThresholdEnergyCosts:!0,ThresholdEnergyGeneration:20,ToggleThresholdEnergyGeneration:!0}},methods:{async formSubmit(){var r,e;if(this.$refs.form.validate()){this.isSubmitting=!0;const l=c(),d={};this.ToggleThresholdEnergyConsumption&&(d.consumption=this.ThresholdEnergyConsumption),this.ToggleThresholdEnergyGeneration&&(d.generation=this.ThresholdEnergyGeneration),this.ToggleThresholdEnergyCosts&&(d.cost=this.ThresholdCosts);const o={notification_settings:{alerts:this.Alerts,frequency:this.NotificationFrequency,thresholds:d}};try{const u=await fetch(`/users/${l.user.id_user}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l.token}`},body:JSON.stringify(o)});if(!u.ok)throw new Error(`Server responded with status ${u.status}`);(r=this.$toast)==null||r.success("Notification preferences updated!")}catch(u){console.error("Failed to update preferences:",u),(e=this.$toast)==null||e.error("Failed to update preferences.")}finally{this.isSubmitting=!1}}else console.log("Form validation failed.")}},mounted(){const r=c();fetch(`/users/${r.user.id_user}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.token}`}}).then(e=>{if(!e.ok)throw new Error(`Failed to fetch user data: ${e.status}`);return e.json()}).then(e=>{const l=e.notification_settings;l&&(this.Alerts=l.alerts??!0,this.NotificationFrequency=l.frequency??"instant",l.thresholds&&(this.ToggleThresholdEnergyConsumption=l.thresholds.consumption!=null,this.ThresholdEnergyConsumption=l.thresholds.consumption??100,this.ToggleThresholdEnergyGeneration=l.thresholds.generation!=null,this.ThresholdEnergyGeneration=l.thresholds.generation??20,this.ToggleThresholdEnergyCosts=l.thresholds.cost!=null,this.ThresholdCosts=l.thresholds.cost??50))}).catch(e=>{var l;console.error("Error loading notification preferences:",e),(l=this.$toast)==null||l.error("Failed to load notification settings.")})},watch:{Alerts(r){this.ToggleThresholdEnergyConsumption=r,this.ToggleThresholdEnergyCosts=r,this.ToggleThresholdEnergyGeneration=r}}};function N(r,e,l,d,o,u){const h=i("v-row"),y=i("v-select"),a=i("v-col"),m=i("v-number-input"),f=i("v-switch"),p=i("v-btn"),T=i("v-form"),E=i("v-card"),v=i("v-container");return C(),b(v,{class:"container"},{default:n(()=>[t(h,{justify:"space-between",align:"center",class:"mb-4"},{default:n(()=>e[7]||(e[7]=[g("h1",{class:"text-h5 pl-4"},"Notification Settings",-1)])),_:1}),t(E,{class:"pa-4"},{default:n(()=>[e[9]||(e[9]=g("p",{class:"text-subtitle-1 mb-4"},"Choose your notification preferences",-1)),t(T,{ref:"form",onSubmit:V(u.formSubmit,["prevent"])},{default:n(()=>[t(h,{class:"mt-8"},{default:n(()=>[t(a,null,{default:n(()=>[t(y,{variant:"outlined",label:"Notification Frequency",density:"default",modelValue:o.NotificationFrequency,"onUpdate:modelValue":e[0]||(e[0]=s=>o.NotificationFrequency=s),clearable:!1,multiple:!1,placeholder:"Instant",items:o.NotificationFrequencyItems,hint:"Choose how often you would like to receive notifications.","persistent-hint":!0,name:"NotificationFrequency"},null,8,["modelValue","items"])]),_:1})]),_:1}),t(h,null,{default:n(()=>[t(a,null,{default:n(()=>[t(m,{modelValue:o.ThresholdEnergyConsumption,"onUpdate:modelValue":e[1]||(e[1]=s=>o.ThresholdEnergyConsumption=s),modelModifiers:{number:!0},label:"Alert Threshold for Energy Consumption (kWh)",name:"ThresholdEnergyConsumption",variant:"outlined",density:"default",hint:"You will receive an alert if your consumption exceeds this threshold.","persistent-hint":!0,min:0,max:1e3,step:10,placeholder:"100",class:"mt-4",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(a,{class:"d-flex align-center"},{default:n(()=>[t(f,{modelValue:o.ToggleThresholdEnergyConsumption,"onUpdate:modelValue":e[2]||(e[2]=s=>o.ToggleThresholdEnergyConsumption=s),"aria-label":"Toggle Energy Consumption Alerts",inset:!1,indeterminate:!1,hint:"Enable or disable this alert"},null,8,["modelValue"])]),_:1})]),_:1}),t(h,null,{default:n(()=>[t(a,null,{default:n(()=>[t(m,{modelValue:o.ThresholdEnergyGeneration,"onUpdate:modelValue":e[3]||(e[3]=s=>o.ThresholdEnergyGeneration=s),modelModifiers:{number:!0},label:"Alert Threshold for Energy Generation (kWh)",name:"ThresholdEnergyGeneration",variant:"outlined",density:"default",hint:"You will receive an alert if your energy generation doesn't reach this threshold.","persistent-hint":!0,min:0,max:1e3,step:10,placeholder:"100"},null,8,["modelValue"])]),_:1}),t(a,{class:"d-flex align-center"},{default:n(()=>[t(f,{modelValue:o.ToggleThresholdEnergyGeneration,"onUpdate:modelValue":e[4]||(e[4]=s=>o.ToggleThresholdEnergyGeneration=s),"aria-label":"Toggle Energy Generation Alerts",inset:!1,indeterminate:!1,hint:"Enable or disable this alert"},null,8,["modelValue"])]),_:1})]),_:1}),t(h,null,{default:n(()=>[t(a,null,{default:n(()=>[t(m,{modelValue:o.ThresholdCosts,"onUpdate:modelValue":e[5]||(e[5]=s=>o.ThresholdCosts=s),modelModifiers:{number:!0},label:"Alert Threshold for energy costs (â‚¬)",name:"ThresholdCosts",variant:"outlined",density:"default",hint:"You will receive an alert if your costs exceed this threshold.","persistent-hint":!0,min:0,max:500,step:10,placeholder:"50",class:"mt-4"},null,8,["modelValue"])]),_:1}),t(a,{class:"d-flex align-center"},{default:n(()=>[t(f,{modelValue:o.ToggleThresholdEnergyCosts,"onUpdate:modelValue":e[6]||(e[6]=s=>o.ToggleThresholdEnergyCosts=s),"aria-label":"Toggle Energy Cost Alerts",inset:!1,indeterminate:!1,hint:"Enable or disable this alert"},null,8,["modelValue"])]),_:1})]),_:1}),t(h,null,{default:n(()=>[t(a,null,{default:n(()=>[t(p,{color:"primary",loading:o.isSubmitting,block:"",class:"mt-4",variant:"flat",size:"large",onClick:u.formSubmit},{default:n(()=>e[8]||(e[8]=[w(" Save Changes ")])),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})}const G=_(S,[["render",N]]);export{G as default};
