import{d as v,v as h,z as n,_ as x,c as y,w as r,r as i,o as E,b as a,e as p,B as F,p as w}from"./index-g7Qn_UOI.js";import{f as g}from"./fetchWithAuth-CvqqA0bk.js";function k(){const e=sessionStorage.getItem("auth");if(!e)return null;try{const t=JSON.parse(e);return!t||!t.token?null:t.token}catch(t){return console.error("Error parsing session data:",t),null}}const V=v("user",{state:()=>({user:null,userFetched:!1}),getters:{},actions:{async fetchUser(){const e=n(),t=h();if(!k()||t.isTokenExpired())return t.logout(),!1;try{const o=await g("http://localhost:3000/auth/me",{method:"GET"});if(!o.ok)throw e.add({color:"error",text:"Failed to fetch user data"}),new Error("Failed to fetch user data");const s=await o.json();return this.user=s,s}catch(o){return console.log(o),!1}finally{this.userFetched=!0}},async updateUser(e){const t=h(),l=await g(`http://localhost:3000/users/${t.getUserId}`,{method:"PATCH",body:JSON.stringify(e)});if(!l.ok){const o=await l.json(),s=new Error(o.error||"Failed to update user");throw s.status=l.status,s.details=o.details,s}t.updateUserState(e)},clearUser(){this.user=null,sessionStorage.removeItem("user")}},persist:{enabled:!0,storage:sessionStorage,pick:["user"]}}),L={data(){return{useUsersStore:V(),useAuthStore:h(),form:null,FirstName:"",LastName:"",Email:"",isSubmitting:!1,emailRules:[e=>!!e||"Email is required",e=>/.+@.+\..+/.test(e)||"Email must be valid",e=>e.length<=45||"Email must be less than 45 characters"],firstNameRules:[e=>!!e||"First Name is required",e=>e.length<=20||"First Name must be less than 20 characters",e=>e.length>=4||"First Name must be more than 4 characters"],lastNameRules:[e=>!!e||"Last Name is required",e=>e.length<=20||"Last Name must be less than 20 characters",e=>e.length>=4||"Last Name must be more than 4 characters"],data:{firstName:"",lastName:"",email:""}}},methods:{async formSubmit(){if(this.$refs.form.validate()){if(this.FirstName.length>20||this.FirstName.length<4){n().add({color:"error",text:"First name must be less than 20 characters and more than 4."});return}if(this.LastName.length>20||this.LastName.length<4){n().add({color:"error",text:"Last name must be less than 20 characters and more than 4."});return}const e=`${this.FirstName.trim()} ${this.LastName.trim()}`.trim();if(e.length>40||e.length<4){n().add({color:"error",text:"Full name must be less than 40 characters and more than 4."});return}if(this.Email.length>45||this.Email.length<4){n().add({color:"error",text:"Email must be less than 45 characters and more than 4."});return}this.isSubmitting=!0,this.data={name:e,email:this.Email};try{await this.useUsersStore.updateUser(this.data),this.isSubmitting=!1,n().add({color:"success",text:"Account information updated successfully."}),this.isSubmitting=!1}catch(t){let l=t.message||"An unexpected error occurred.";t.details&&(l=t.details.map(o=>`${o.field}: ${o.message}`).join(", ")),n().add({color:"error",text:l}),this.isSubmitting=!1}}else n().add({color:"error",text:"Error updating account information."})}},mounted(){console.log("âœ… AccountInformationView mounted!");const e=this.useAuthStore.user.name||"",t=e.split(" ")[0],l=e.split(" ")[1];this.FirstName=t||"",this.LastName=l||"",this.Email=this.useAuthStore.user.email||""}};function U(e,t,l,o,s,f){const m=i("v-row"),d=i("v-text-field"),c=i("v-col"),N=i("v-btn"),b=i("v-form"),_=i("v-card"),S=i("v-container");return E(),y(S,{class:"container"},{default:r(()=>[a(m,{justify:"space-between",align:"center",class:"mb-4"},{default:r(()=>t[3]||(t[3]=[p("h1",{class:"text-h5 pl-4"},"Account information",-1)])),_:1}),a(_,{class:"pa-4"},{default:r(()=>[t[5]||(t[5]=p("p",{class:"text-subtitle-1 mb-4"},"Update your account information",-1)),a(b,{ref:"form",onSubmit:F(f.formSubmit,["prevent"])},{default:r(()=>[a(m,null,{default:r(()=>[a(c,null,{default:r(()=>[a(d,{variant:"outlined",label:"First Name",density:"default",modelValue:s.FirstName,"onUpdate:modelValue":t[0]||(t[0]=u=>s.FirstName=u),autocomplete:"given-name",placeholder:"John",type:"text",hint:"","persistent-hint":!1,class:"",name:"First Name",rules:s.firstNameRules,counter:"",required:""},null,8,["modelValue","rules"])]),_:1}),a(c,null,{default:r(()=>[a(d,{variant:"outlined",label:"Last Name",density:"default",modelValue:s.LastName,"onUpdate:modelValue":t[1]||(t[1]=u=>s.LastName=u),autocomplete:"family-name",placeholder:"Doe",type:"text",hint:"","persistent-hint":!1,class:"",name:"Last Name",rules:s.lastNameRules,counter:"",required:""},null,8,["modelValue","rules"])]),_:1})]),_:1}),a(m,null,{default:r(()=>[a(c,null,{default:r(()=>[a(d,{variant:"outlined",label:"Email",density:"default",modelValue:s.Email,"onUpdate:modelValue":t[2]||(t[2]=u=>s.Email=u),autocomplete:"email",placeholder:"example@example.com",type:"text",hint:"","persistent-hint":!1,class:"",name:"Email",rules:s.emailRules,counter:"",required:""},null,8,["modelValue","rules"])]),_:1})]),_:1}),a(m,null,{default:r(()=>[a(c,null,{default:r(()=>[a(N,{color:"primary",loading:s.isSubmitting,block:"",class:"mt-4",variant:"flat",size:"large",onClick:f.formSubmit},{default:r(()=>t[4]||(t[4]=[w("Save Changes")])),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})}const C=x(L,[["render",U]]);export{C as default};
