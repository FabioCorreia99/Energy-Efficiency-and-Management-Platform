import{_ as P,c as b,w as o,r as n,z as l,v as _,o as C,b as s,e as w,B as y,p as S}from"./index-g7Qn_UOI.js";import{f as v}from"./fetchWithAuth-CvqqA0bk.js";const V={data(){return{authStore:_(),useMessagesStore:l(),form:null,isSubmitting:!1,userEmail:"",CurrentPassword:"",NewPassword:"",ConfirmPassword:"",passwordRules:[t=>!!t||"Password is required",t=>t===t.trim()||"Password cannot start or end with spaces",t=>t.length<=10||"Password must be less than 10 characters"]}},methods:{async formSubmit(){if(this.$refs.form.validate()){if(this.CurrentPassword.length>10||this.CurrentPassword.length==0){console.error("Current password must be less than 10 characters and cannot be empty.");return}if(this.NewPassword.length>10||this.NewPassword.length==0){console.error("New password must be less than 10 characters and cannot be empty.");return}if(this.ConfirmPassword.length>10||this.ConfirmPassword.length==0){console.error("Confirm password must be less than 10 characters and cannot be empty.");return}if(this.NewPassword!==this.ConfirmPassword){l().add({color:"error",text:"New password and confirm password do not match."});return}this.isSubmitting=!0,this.data={currentPassword:this.CurrentPassword,newPassword:this.NewPassword};try{const t=await v(`http://localhost:3000/users/${this.authStore.getUserId}/changePassword`,{method:"PATCH",body:JSON.stringify(this.data)});if(!t.ok){const e=await t.json();throw new Error(e.message||"Failed to change password")}this.isSubmitting=!1,l().add({color:"success",text:"Password changed successfully."})}catch(t){let e=t.message||"An unexpected error occurred.";t.details&&(e=t.details.map(m=>`${m.field}: ${m.message}`).join(", ")),l().add({color:"error",text:e}),this.isSubmitting=!1}}else l().add({color:"error",text:"Error changing password."})}},mounted(){this.userEmail=this.authStore.getUserEmail,console.log("âœ… SecuritySettingsView mounted!")}};function N(t,e,m,x,r,c){const d=n("v-row"),i=n("v-text-field"),u=n("v-col"),p=n("v-btn"),f=n("v-form"),h=n("v-card"),g=n("v-container");return C(),b(g,{class:"container"},{default:o(()=>[s(d,{justify:"space-between",align:"center",class:"mb-4"},{default:o(()=>e[4]||(e[4]=[w("h1",{class:"text-h5 pl-4"},"Security Settings",-1)])),_:1}),s(h,{class:"pa-4"},{default:o(()=>[e[6]||(e[6]=w("p",{class:"text-subtitle-1 mb-4"},"Change your password",-1)),s(f,{ref:"form",onSubmit:y(c.formSubmit,["prevent"])},{default:o(()=>[s(d,null,{default:o(()=>[s(u,null,{default:o(()=>[s(i,{variant:"outlined",label:"username",density:"default",modelValue:r.userEmail,"onUpdate:modelValue":e[0]||(e[0]=a=>r.userEmail=a),type:"text",autocomplete:"username",name:"username",style:{display:"none"}},null,8,["modelValue"]),s(i,{variant:"outlined",label:"Current Password",density:"default",modelValue:r.CurrentPassword,"onUpdate:modelValue":e[1]||(e[1]=a=>r.CurrentPassword=a),placeholder:"",type:"password",hint:"Password must be less than 10 characters","persistent-hint":!1,class:"",autocomplete:"new-password",name:"Current Password",rules:r.passwordRules},null,8,["modelValue","rules"])]),_:1})]),_:1}),s(d,null,{default:o(()=>[s(u,null,{default:o(()=>[s(i,{variant:"outlined",label:"New Password",density:"default",modelValue:r.NewPassword,"onUpdate:modelValue":e[2]||(e[2]=a=>r.NewPassword=a),placeholder:"",type:"password",hint:"Password must be less than 10 characters","persistent-hint":!1,class:"",autocomplete:"new-password",name:"New Password",rules:r.passwordRules},null,8,["modelValue","rules"])]),_:1}),s(u,null,{default:o(()=>[s(i,{variant:"outlined",label:"Confirm New Password",density:"default",modelValue:r.ConfirmPassword,"onUpdate:modelValue":e[3]||(e[3]=a=>r.ConfirmPassword=a),placeholder:"",type:"password",hint:"Password must be less than 10 characters","persistent-hint":!1,class:"",autocomplete:"new-password",name:"Confirm Password",rules:r.passwordRules},null,8,["modelValue","rules"])]),_:1})]),_:1}),s(d,null,{default:o(()=>[s(u,null,{default:o(()=>[s(p,{color:"primary",loading:r.isSubmitting,block:"",class:"mt-4",variant:"flat",size:"large",onClick:c.formSubmit},{default:o(()=>e[5]||(e[5]=[S("Save Changes")])),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})}const U=P(V,[["render",N]]);export{U as default};
